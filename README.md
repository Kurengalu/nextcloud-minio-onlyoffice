# nextcloud-minio-onlyoffice
Доброго времени суток, представляю своё тестовое задание на проверку. 
Виртуальная машина в VMWare Workstation Pro 17.5
ОЗУ 8 ГБ
4 CPU
ПЗУ 40 ГБ
1 виртуальный сетевой интерфейс (NAT)
Начал я с установки Debian 13 на виртуалку, на ней прокинул NAT для доступа в инет.
Установил docker, docker-compose.
Далее начал писать docker-compose для каждого комплекса отдельно, чтобы модульно настраивать каждый из них. (далее они уже были объединены, кроме prometheus+grafana, так мне показалось удобнее отделить доп. задание)
Начал я с Nextcloud. Написал docker-compose файл, запустил контейнер, встретился с проблемой того, что доступа в интернет не было с контейнера. Зашел в контейнер при помощи docker exec -it nextcloud bash, прописал в /etc/resolv.conf 8.8.8.8 (echo nameserver=8.8.8.8 >> /etc/resolv.conf, сохранил, после этого появился доступ до Магазина приложений в веб-морде.
Далее создал отдельную сеть под названием "nextcloud", куда и закидывал все контейнеры после установки через docker network connect.
После Nextcloud поднял MinIO, добавил его как S3-хранилище в nextcloud (скрины приложил). Проверил на работоспособность, файлы создаются, редактируются. Также стоит добавить, что MinIO с недавнего времени перестал бесплатно предоставлять свои сервисы, теперь у них обрезанная версия, в которой есть возможность создать только Bucket и всё, подключить его невозможно, доступ к нему настроить тоже. Поэтому было принято решение установить более старую версию, в которой данный функционал присутствует (в docker-compose.yml указан конкретный релиз)
Следующим шагом для меня стала установка onlyoffice document-server. Встретился с проблемой интеграции. Починил путем указания сервера, с которого идет запрос на onlyoffice, иначе он отклоняет запросы по ошибке ECONNREFUSED. Файл Excel создал в Nextcloud, отредактировал, изменения появились и в MinIO.
История команд:
mkdir /opt/{nextcloud,minio,onlyoffice}
docker compose up -d (для всех контейнеров, в последующем для одного)
docker network create nextcloud
docker network connect <все_контейнеры>
docker exec -it nextcloud bash
docker ps -a
Как зайти в веб-морду каждого из комплексов:
http://localhost:8081 - Nextcloud
http://localhost:9000 - MinIO
http://localhost:9090 - Prometheus
http://localhost:3000 - Grafana
http://localhost:80 - Onlyoffice 
Также у каждого из веб-морд есть отдельный IP-адрес, по которому также можно зайти. (подсеть 172.20.0.0/16 [1-10])
Бэкапы делал локально через снапшоты в VMWare Workstation Pro
